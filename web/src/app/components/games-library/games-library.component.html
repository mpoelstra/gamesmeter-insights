<article class="library-layout">
  <div class="card library-main">
    <button type="button" class="clear-button clear-button-floating" (click)="clearFilters()">
      {{ i18n.t('filters.clear') }}
    </button>
    <div class="library-header">
      <h3>{{ i18n.t('library.title') }}</h3>
      <p class="muted">{{ i18n.t('library.subtitle') }}</p>
      <p class="summary">{{ i18n.t('library.summary', { filtered: filteredCount, total: totalCount }) }}</p>
    </div>

    <div class="filters-row">
      <div class="filters">
        <label class="filter filter-search">
          {{ i18n.t('filters.search') }}
          <input type="search" [value]="query()" (input)="updateQuery($any($event.target).value)" />
        </label>
        <label class="filter filter-platform">
          {{ i18n.t('filters.platform') }}
          <select [value]="platformFilter()" (change)="updatePlatform($any($event.target).value)">
            @for (platform of platforms; track platform) {
              <option [value]="platform" [selected]="platformFilter() === platform">
                {{ platform === 'all' ? i18n.t('filters.allPlatforms') : platform }}
              </option>
            }
          </select>
        </label>
        <label class="filter">
          {{ i18n.t('filters.year') }}
          <select [value]="yearFilter()" (change)="updateYear($any($event.target).value)">
            @for (year of years; track year) {
              <option [value]="year">{{ year === 'all' ? i18n.t('filters.allYears') : year }}</option>
            }
          </select>
        </label>
        <label class="filter">
          {{ i18n.t('filters.ratedYear') }}
          <select [value]="ratedYearFilter()" (change)="updateRatedYear($any($event.target).value)">
            @for (year of ratedYears; track year) {
              <option [value]="year">{{ year === 'all' ? i18n.t('filters.allRatedYears') : year }}</option>
            }
          </select>
        </label>
        <label class="filter">
          {{ i18n.t('filters.rating') }}
          <select [value]="ratingFilter()" (change)="updateRating($any($event.target).value)">
            @for (option of ratingOptions; track option.value) {
              <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
        </label>
        <label class="filter">
          {{ i18n.t('filters.sort') }}
          <select [value]="sortFilter()" (change)="updateSort($any($event.target).value)">
            @for (option of sortOptions; track option.value) {
              <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
        </label>
        <label class="filter">
          {{ i18n.t('filters.letter') }}
          <select [value]="letterFilter()" (change)="updateLetter($any($event.target).value)">
            @for (letter of letters; track letter) {
              <option [value]="letter">{{ letter === 'all' ? i18n.t('filters.allLetters') : letter }}</option>
            }
          </select>
        </label>
      </div>
    </div>

    <div class="game-list">
      @if (sortedRows.length === 0) {
        <div class="empty-state">
          <p>{{ i18n.t('library.empty') }}</p>
        </div>
      } @else {
        @for (game of sortedRows; track trackByTitle($index, game)) {
          <div class="game-item">
            <img
              class="game-platform-logo"
              [src]="platformImage(game.platform).src"
              [alt]="game.platform ?? i18n.t('label.platformUnknown')"
              loading="lazy"
              decoding="async"
            />
            <div class="game-details">
              <p class="game-title">
                @for (part of highlightParts(game.title); track part.text + part.match) {
                  <span [class.highlight]="part.match">{{ part.text }}</span>
                }
              </p>
            <p class="muted">
              {{ game.platform ?? i18n.t('label.platformUnknown') }} Â·
              {{ game.year ?? i18n.t('label.yearUnknown') }}
            </p>
            @if (game.placed) {
              <p class="muted rated-line">
                {{ i18n.t('label.ratedOn') }} {{ i18n.formatDate(game.placed) }}
              </p>
            }
            </div>
            <div class="rating-stars" [attr.aria-label]="game.rating?.toFixed(1) ?? i18n.t('label.na')">
              @for (state of getStarStates(game.rating); track $index) {
                <span class="star" [class.full]="state === 'full'" [class.half]="state === 'half'">
                  <svg class="star-icon" viewBox="0 0 24 24" aria-hidden="true">
                    <path
                      class="star-base"
                      d="M12 2.8l2.86 5.79 6.4.93-4.63 4.51 1.09 6.36L12 17.76l-5.72 3 1.09-6.36L2.74 9.52l6.4-.93L12 2.8z"
                    />
                    <path
                      class="star-fill"
                      d="M12 2.8l2.86 5.79 6.4.93-4.63 4.51 1.09 6.36L12 17.76l-5.72 3 1.09-6.36L2.74 9.52l6.4-.93L12 2.8z"
                    />
                  </svg>
                </span>
              }
            </div>
          </div>
        }
      }
    </div>
  </div>
</article>
